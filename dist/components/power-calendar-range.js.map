{"version":3,"file":"power-calendar-range.js","sources":["../../src/components/power-calendar-range.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport service from '../-private/service.ts';\nimport { guidFor } from '@ember/object/internals';\nimport { assert } from '@ember/debug';\nimport { task, type TaskInstance } from 'ember-concurrency';\nimport PowerCalendarRangeDaysComponent, {\n  type PowerCalendarRangeDaysSignature,\n} from './power-calendar-range/days.gts';\nimport PowerCalendarRangeNavComponent, {\n  type PowerCalendarRangeNavSignature,\n} from './power-calendar-range/nav.gts';\nimport {\n  normalizeDate,\n  normalizeRangeActionValue,\n  diff,\n  isAfter,\n  isBefore,\n  normalizeDuration,\n  normalizeCalendarValue,\n  add,\n  type NormalizeRangeActionValue,\n  type PowerCalendarDay,\n  type SelectedPowerCalendarRange,\n  type NormalizeCalendarValue,\n} from '../utils.ts';\nimport type {\n  PowerCalendarAPI,\n  PowerCalendarArgs,\n  SelectedDays,\n  // PowerCalendarActions,\n  // CalendarDay,\n  TPowerCalendarMoveCenterUnit,\n} from './power-calendar.ts';\nimport { DAY_IN_MS as UTILS_DAY_IN_MS } from '../-private/days-utils.ts';\nimport { element } from 'ember-element-helper';\nimport { hash } from '@ember/helper';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type PowerCalendarService from '../services/power-calendar.ts';\n\nexport interface PowerCalendarRangeDay extends Omit<PowerCalendarDay, 'date'> {\n  date: SelectedPowerCalendarRange | Date;\n}\n\nexport const DAY_IN_MS = UTILS_DAY_IN_MS;\n\nexport type TPowerCalendarRangeOnSelect = (\n  day: NormalizeRangeActionValue,\n  calendar: PowerCalendarRangeAPI,\n  event?: Event,\n) => void;\n\ninterface PowerCalendarRangeArgs extends Omit<\n  PowerCalendarArgs,\n  | 'daysComponent'\n  | 'navComponent'\n  | 'selected'\n  | 'onSelect'\n  | 'onCenterChange'\n  | 'onInit'\n> {\n  navComponent?: ComponentLike<PowerCalendarRangeNavSignature>;\n  daysComponent?: ComponentLike<PowerCalendarRangeDaysSignature>;\n  selected?: SelectedPowerCalendarRange;\n  minRange?: number;\n  maxRange?: number;\n  proximitySelection?: boolean;\n  onSelect?: TPowerCalendarRangeOnSelect;\n  onInit?: (calendar: PowerCalendarRangeAPI) => void;\n  onCenterChange?: (\n    newCenter: NormalizeCalendarValue,\n    calendar: PowerCalendarRangeAPI,\n    event: Event,\n  ) => Promise<void> | void;\n}\n\nexport interface PowerCalendarRangeDefaultBlock extends PowerCalendarRangeAPI {\n  Nav: ComponentLike<{\n    Args: Omit<PowerCalendarRangeNavSignature['Args'], 'calendar'>;\n    Blocks: PowerCalendarRangeNavSignature['Blocks'];\n  }>;\n  Days: ComponentLike<{\n    Element: PowerCalendarRangeDaysSignature['Element'];\n    Args: Omit<PowerCalendarRangeDaysSignature['Args'], 'calendar'>;\n    Blocks: PowerCalendarRangeDaysSignature['Blocks'];\n  }>;\n}\n\ninterface PowerCalendarRangeSignature {\n  Element: HTMLElement;\n  Args: PowerCalendarRangeArgs;\n  Blocks: {\n    default: [PowerCalendarRangeDefaultBlock];\n  };\n}\n\nexport interface PowerCalendarRangeActions {\n  changeCenter?: (\n    newCenter: Date,\n    calendar: PowerCalendarRangeAPI,\n    event: Event,\n  ) => TaskInstance<void>;\n  moveCenter?: (\n    step: number,\n    unit: TPowerCalendarMoveCenterUnit,\n    calendar: PowerCalendarRangeAPI,\n    event: Event | KeyboardEvent,\n  ) => Promise<void>;\n  select?: (\n    day: PowerCalendarRangeDay,\n    calendar: PowerCalendarRangeAPI,\n    event?: Event,\n  ) => void;\n}\n\nexport interface PowerCalendarRangeAPI extends Omit<\n  PowerCalendarAPI,\n  'type' | 'selected' | 'actions'\n> {\n  type: 'range';\n  selected?: SelectedPowerCalendarRange;\n  minRange?: number | null;\n  maxRange?: number | null;\n  actions: PowerCalendarRangeActions;\n}\n\nexport default class PowerCalendarRange extends Component<PowerCalendarRangeSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked center = null;\n  @tracked _selected?: SelectedDays;\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: PowerCalendarRangeArgs) {\n    super(owner, args);\n    this.registerCalendar();\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n  }\n\n  willDestroy(): void {\n    super.willDestroy();\n    this.unregisterCalendar();\n  }\n\n  get publicActions(): PowerCalendarRangeActions {\n    const onSelect = this.args.onSelect;\n    const select = this.select.bind(this);\n    const onCenterChange = this.args.onCenterChange;\n    const changeCenterTask = this.changeCenterTask;\n    const currentCenter = this.currentCenter;\n\n    const actions: PowerCalendarRangeActions = {};\n    if (onSelect) {\n      actions.select = (...args) => select(...args);\n    }\n    if (onCenterChange) {\n      const changeCenter = (\n        newCenter: Date,\n        calendar: PowerCalendarRangeAPI,\n        e: Event,\n      ) => {\n        return changeCenterTask.perform(newCenter, calendar, e);\n      };\n      actions.changeCenter = changeCenter;\n      actions.moveCenter = async (step, unit, calendar, e) => {\n        const newCenter = add(currentCenter, step, unit);\n        return await changeCenter(newCenter, calendar, e);\n      };\n    }\n\n    return actions;\n  }\n\n  get selected(): SelectedPowerCalendarRange {\n    if (this._selected) {\n      return this._selected as SelectedPowerCalendarRange;\n    }\n\n    if (this.args.selected) {\n      return {\n        start: normalizeDate(this.args.selected.start),\n        end: normalizeDate(this.args.selected.end),\n      };\n    }\n\n    return { start: undefined, end: undefined };\n  }\n\n  set selected(v) {\n    if (v === undefined || v === null) {\n      v = {};\n    }\n    this._selected = {\n      start: normalizeDate(v.start),\n      end: normalizeDate(v.end),\n    };\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n    if (!center) {\n      center = this.selected.start || this.powerCalendar.getDate();\n    }\n    return normalizeDate(center) || this.powerCalendar.getDate();\n  }\n\n  get publicAPI(): PowerCalendarRangeAPI {\n    return {\n      uniqueId: guidFor(this),\n      type: 'range',\n      selected: this.selected,\n      loading: this.changeCenterTask.isRunning,\n      center: this.currentCenter,\n      locale: this.args.locale || this.powerCalendar.locale,\n      actions: this.publicActions,\n      minRange: this.minRange,\n      maxRange: this.maxRange,\n    };\n  }\n\n  get tagWithDefault(): keyof HTMLElementTagNameMap {\n    if (this.args.tag === undefined || this.args.tag === null) {\n      return 'div';\n    }\n    return this.args.tag;\n  }\n\n  get proximitySelection(): boolean {\n    return this.args.proximitySelection !== undefined\n      ? this.args.proximitySelection\n      : false;\n  }\n\n  get minRange(): number | null {\n    if (this.args.minRange !== undefined) {\n      return this._formatRange(this.args.minRange) as number;\n    }\n\n    return DAY_IN_MS;\n  }\n\n  get maxRange(): number | null {\n    if (this.args.maxRange !== undefined) {\n      return this._formatRange(this.args.maxRange) as number;\n    }\n\n    return null;\n  }\n\n  get navComponent(): ComponentLike<PowerCalendarRangeNavSignature> {\n    return (\n      this.args.navComponent ||\n      (PowerCalendarRangeNavComponent as ComponentLike<PowerCalendarRangeNavSignature>)\n    );\n  }\n\n  get daysComponent(): ComponentLike<PowerCalendarRangeDaysSignature> {\n    return (\n      this.args.daysComponent ||\n      (PowerCalendarRangeDaysComponent as ComponentLike<PowerCalendarRangeDaysSignature>)\n    );\n  }\n\n  calendarAPI(\n    publicAPI: PowerCalendarRangeAPI,\n    components: {\n      Nav: ComponentLike<PowerCalendarRangeNavSignature>;\n      Days: ComponentLike<PowerCalendarRangeDaysSignature>;\n    },\n  ): PowerCalendarRangeDefaultBlock {\n    return Object.assign(\n      {},\n      publicAPI,\n      components,\n    ) as PowerCalendarRangeDefaultBlock;\n  }\n\n  // Tasks\n  changeCenterTask = task(\n    async (newCenter: Date, calendar: PowerCalendarRangeAPI, e: Event) => {\n      assert(\n        \"You attempted to move the center of a calendar that doesn't receive an `@onCenterChange` action.\",\n        typeof this.args.onCenterChange === 'function',\n      );\n      const value = normalizeCalendarValue({ date: newCenter });\n      await this.args.onCenterChange(value, calendar, e);\n    },\n  );\n\n  // Actions\n  @action\n  select(\n    day: PowerCalendarRangeDay,\n    calendar: PowerCalendarRangeAPI,\n    e?: Event,\n  ) {\n    const { date } = day;\n    assert(\n      'date must be either a Date, or a Range',\n      date && ('start' in date || 'end' in date || date instanceof Date),\n    );\n\n    let range: NormalizeRangeActionValue;\n\n    if ('start' in date && 'end' in date) {\n      range = { date };\n    } else {\n      range = this._buildRange({ date } as { date: Date });\n    }\n\n    const { start, end } = range.date;\n    if (start && end) {\n      const { minRange, maxRange } = this.publicAPI;\n      const diffInMs = Math.abs(diff(end, start));\n      if (\n        diffInMs < (minRange ?? DAY_IN_MS) ||\n        (maxRange && diffInMs > maxRange)\n      ) {\n        return;\n      }\n    }\n\n    if (this.args.onSelect) {\n      this.args.onSelect(range, calendar, e);\n    }\n  }\n\n  _formatRange(v: number | undefined) {\n    if (typeof v === 'number') {\n      return v * DAY_IN_MS;\n    }\n\n    return normalizeDuration(v === undefined ? DAY_IN_MS : v);\n  }\n\n  // Methods\n  _buildRange(day: { date: Date }): NormalizeRangeActionValue {\n    const selected = this.selected || { start: null, end: null };\n    const { start, end } = selected;\n\n    if (this.proximitySelection) {\n      return this._buildRangeByProximity(day, start, end);\n    }\n\n    return this._buildDefaultRange(day, start, end);\n  }\n\n  _buildRangeByProximity(\n    day: { date: Date },\n    start?: Date | null,\n    end?: Date | null,\n  ): NormalizeRangeActionValue {\n    if (start && end) {\n      const changeStart =\n        Math.abs(diff(day.date, end)) > Math.abs(diff(day.date, start));\n\n      return normalizeRangeActionValue({\n        date: {\n          start: changeStart ? day.date : start,\n          end: changeStart ? end : day.date,\n        },\n      });\n    }\n\n    if (start && isBefore(day.date, start)) {\n      return normalizeRangeActionValue({\n        date: { start: day.date, end: null },\n      });\n    }\n\n    return this._buildDefaultRange(day, start, end);\n  }\n\n  _buildDefaultRange(\n    day: { date: Date },\n    start?: Date | null,\n    end?: Date | null,\n  ): NormalizeRangeActionValue {\n    if (start && !end) {\n      if (isAfter(start, day.date)) {\n        return normalizeRangeActionValue({\n          date: { start: day.date, end: start },\n        });\n      }\n      return normalizeRangeActionValue({\n        date: { start: start, end: day.date },\n      });\n    }\n\n    return normalizeRangeActionValue({ date: { start: day.date, end: null } });\n  }\n\n  // Methods\n  registerCalendar() {\n    if (window) {\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      window.__powerCalendars = window.__powerCalendars || {}; // TODO: weakmap??\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      window.__powerCalendars[this.publicAPI.uniqueId] = this;\n    }\n  }\n\n  unregisterCalendar() {\n    // @ts-expect-error Property '__powerCalendars'\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (window && window.__powerCalendars?.[guidFor(this)]) {\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      delete window.__powerCalendars[guidFor(this)];\n\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      if (Object.keys(window.__powerCalendars).length === 0) {\n        // @ts-expect-error Property '__powerCalendars'\n        delete window.__powerCalendars;\n      }\n    }\n  }\n\n  <template>\n    {{#let\n      (this.calendarAPI\n        this.publicAPI\n        (hash\n          Nav=(component\n            this.navComponent calendar=this.publicAPI isDatePicker=@isDatePicker\n          )\n          Days=(component\n            this.daysComponent\n            calendar=this.publicAPI\n            isDatePicker=@isDatePicker\n            autofocus=@autofocus\n          )\n        )\n      )\n      as |calendar|\n    }}\n      {{#let (element this.tagWithDefault) as |Tag|}}\n        <Tag\n          class=\"ember-power-calendar\"\n          role={{if @isDatePicker \"dialog\" \"group\"}}\n          aria-modal={{if @isDatePicker \"true\"}}\n          aria-label={{if\n            @ariaLabel\n            @ariaLabel\n            (unless @ariaLabeledBy \"Choose Date Range\")\n          }}\n          aria-labelledby={{@ariaLabeledBy}}\n          ...attributes\n          id={{calendar.uniqueId}}\n        >\n          {{#if (has-block)}}\n            {{yield calendar}}\n          {{else}}\n            <calendar.Nav />\n            <calendar.Days />\n          {{/if}}\n        </Tag>\n      {{/let}}\n    {{/let}}\n  </template>\n}\n"],"names":["DAY_IN_MS","UTILS_DAY_IN_MS","PowerCalendarRange","Component","g","prototype","service","i","tracked","constructor","owner","args","registerCalendar","onInit","publicAPI","willDestroy","unregisterCalendar","publicActions","onSelect","select","bind","onCenterChange","changeCenterTask","currentCenter","actions","changeCenter","newCenter","calendar","e","perform","moveCenter","step","unit","add","selected","_selected","start","normalizeDate","end","undefined","v","center","powerCalendar","getDate","uniqueId","guidFor","type","loading","isRunning","locale","minRange","maxRange","tagWithDefault","tag","proximitySelection","_formatRange","navComponent","PowerCalendarRangeNavComponent","daysComponent","PowerCalendarRangeDaysComponent","calendarAPI","components","Object","assign","_buildTask","context","generator","assert","value","normalizeCalendarValue","date","day","Date","range","_buildRange","diffInMs","Math","abs","diff","n","action","normalizeDuration","_buildRangeByProximity","_buildDefaultRange","changeStart","normalizeRangeActionValue","isBefore","isAfter","window","__powerCalendars","keys","length","setComponentTemplate","precompileTemplate","strictMode","scope","hash","element"],"mappings":"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"}