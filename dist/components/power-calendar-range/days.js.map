{"version":3,"file":"days.js","sources":["../../../src/components/power-calendar-range/days.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { scheduleOnce } from '@ember/runloop';\nimport service from '../../-private/service.ts';\nimport emberPowerCalendarDayClasses, {\n  type TDayClass,\n} from '../../helpers/ember-power-calendar-day-classes.ts';\nimport { or } from 'ember-truth-helpers';\nimport {\n  isBetween,\n  isSame,\n  diff,\n  isBefore,\n  add,\n  withLocale,\n  getWeekdaysMin,\n  getWeekdaysShort,\n  getWeekdays,\n  normalizeDate,\n  type PowerCalendarDay,\n  formatDate,\n  type TWeekdayFormat,\n} from '../../utils.ts';\nimport {\n  buildDay,\n  firstDay,\n  lastDay,\n  localeStartOfWeekOrFallback,\n  weekdaysNames,\n  weeks,\n  handleDayKeyDown,\n  focusDate,\n  handleClick,\n  dayIsDisabled,\n  DAY_IN_MS,\n  type Week,\n} from '../../-private/days-utils.ts';\nimport { modifier } from 'ember-modifier';\nimport { on } from '@ember/modifier';\nimport type { PowerCalendarDaysArgs } from '../power-calendar/days.ts';\nimport type { PowerCalendarRangeAPI } from '../power-calendar-range.ts';\nimport type PowerCalendarService from '../../services/power-calendar.ts';\n\ninterface PowerCalendarMultipleDaysArgs extends Omit<\n  PowerCalendarDaysArgs,\n  'calendar' | 'dayClass' | 'selected'\n> {\n  calendar: PowerCalendarRangeAPI;\n  dayClass?: TDayClass<PowerCalendarRangeAPI>;\n  selected?: {\n    start: Date | null;\n    end: Date | null;\n  };\n}\n\nexport interface PowerCalendarRangeDaysSignature {\n  Element: HTMLElement;\n  Args: PowerCalendarMultipleDaysArgs;\n  Blocks: {\n    default: [\n      day: PowerCalendarDay,\n      calendar: PowerCalendarRangeAPI,\n      weeks: Week[],\n    ];\n  };\n}\n\nexport default class PowerCalendarRangeDays extends Component<PowerCalendarRangeDaysSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked focusedId: string | null = null;\n\n  didSetup = false;\n  lastKeyDownWasSpace = false;\n\n  get weekdayFormat(): TWeekdayFormat {\n    return this.args.weekdayFormat || 'short'; // \"min\" | \"short\" | \"long\"\n  }\n\n  get showDaysAround(): boolean {\n    return this.args.showDaysAround !== undefined\n      ? this.args.showDaysAround\n      : true;\n  }\n\n  get weekdaysMin(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysMin) as string[];\n  }\n\n  get weekdaysShort(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysShort) as string[];\n  }\n\n  get weekdays(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdays) as string[];\n  }\n\n  get localeStartOfWeek(): number {\n    return localeStartOfWeekOrFallback(\n      this.args.startOfWeek,\n      this.args.calendar.locale,\n    );\n  }\n\n  get weekdaysNames(): string[] {\n    return weekdaysNames(\n      this.localeStartOfWeek,\n      this.weekdayFormat,\n      this.weekdays,\n      this.weekdaysMin,\n      this.weekdaysShort,\n    );\n  }\n\n  get days(): PowerCalendarDay[] {\n    const today = this.powerCalendar.getDate();\n    const theLastDay = lastDay(this.localeStartOfWeek, this.currentCenter);\n    let day = firstDay(this.currentCenter, this.localeStartOfWeek);\n    const days: PowerCalendarDay[] = [];\n    while (isBefore(day, theLastDay)) {\n      days.push(this.buildDay(day, today, this.args.calendar));\n      day = add(day, 1, 'day');\n    }\n    return days;\n  }\n\n  get weeks(): Week[] {\n    return weeks(this.days, this.showDaysAround);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n\n    if (!center) {\n      center = this.args.selected?.start || this.args.calendar.center;\n    }\n    return normalizeDate(center) || this.args.calendar.center;\n  }\n\n  // Actions\n  @action\n  handleDayFocus(e: FocusEvent): void {\n    scheduleOnce(\n      'actions',\n      this,\n      this._updateFocused.bind(this),\n      (e.target as HTMLElement).dataset['date'],\n    );\n  }\n\n  @action\n  handleDayBlur(): void {\n    scheduleOnce('actions', this, this._updateFocused.bind(this), null);\n  }\n\n  @action\n  async handleKeyDown(e: KeyboardEvent): Promise<void> {\n    this.lastKeyDownWasSpace = e.code === 'Space';\n\n    const day = handleDayKeyDown(e, this.focusedId, this.days);\n\n    if (!day || !day?.isCurrentMonth) {\n      if (this.args.calendar.actions.moveCenter) {\n        if (\n          e.key === 'ArrowUp' ||\n          e.key === 'ArrowRight' ||\n          e.key === 'ArrowDown' ||\n          e.key === 'ArrowLeft'\n        ) {\n          const currentDay = this.days.find(\n            (x) => x.id === this.focusedId,\n          )?.date;\n\n          if (currentDay) {\n            let date = currentDay;\n            let step = 1;\n            if (e.key === 'ArrowUp') {\n              date = add(currentDay, -7, 'day');\n              step = -1;\n            } else if (e.key === 'ArrowLeft') {\n              date = add(currentDay, -1, 'day');\n              step = -1;\n            } else if (e.key === 'ArrowRight') {\n              date = add(currentDay, 1, 'day');\n            } else if (e.key === 'ArrowDown') {\n              date = add(currentDay, 7, 'day');\n            }\n\n            await this.focusDay(e, date, step);\n\n            return;\n          }\n        }\n      }\n    }\n\n    if (!day) {\n      return;\n    }\n\n    this.focusedId = day.id;\n    scheduleOnce(\n      'afterRender',\n      this,\n      focusDate,\n      this.args.calendar.uniqueId,\n      this.focusedId ?? '',\n    );\n  }\n\n  @action\n  async handleClick(e: MouseEvent) {\n    const selectedDay = handleClick(e, this.days, this.args.calendar);\n\n    if (\n      this.lastKeyDownWasSpace &&\n      selectedDay &&\n      (this.args.calendar.minRange ?? 0) > 0 &&\n      !this.args.calendar.selected?.end\n    ) {\n      const focusDay = add(\n        selectedDay.date,\n        (this.args.calendar.minRange ?? 0) / DAY_IN_MS,\n        'day',\n      );\n      const dayInCurrentCalendar = this.days.some(\n        (x) => x.id === formatDate(focusDay, 'YYYY-MM-DD') && x.isCurrentMonth,\n      );\n\n      await this.focusDay(e, focusDay, dayInCurrentCalendar ? 0 : 1);\n    }\n\n    this.lastKeyDownWasSpace = false;\n  }\n\n  setup = modifier(\n    () => {\n      if (this.didSetup) {\n        return;\n      }\n\n      this.didSetup = true;\n\n      if (this.args.autofocus) {\n        scheduleOnce('afterRender', this, this.initialFocus.bind(this));\n      }\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  initialFocus() {\n    const activeDay = this.days.find((x) => x.isSelected && !x.isDisabled);\n\n    if (activeDay) {\n      this.focusedId = activeDay.id;\n    } else {\n      const todayDay = this.days.find((x) => x.isToday && !x.isDisabled);\n      if (todayDay) {\n        this.focusedId = todayDay.id ?? '';\n      } else {\n        const firstSelectableDay = this.days.find((x) => !x.isDisabled);\n        if (firstSelectableDay) {\n          this.focusedId = firstSelectableDay.id ?? '';\n        } else {\n          this.focusedId = this.days.find((x) => !x.isCurrentMonth)?.id ?? '';\n        }\n      }\n    }\n\n    focusDate(this.args.calendar.uniqueId, this.focusedId ?? '');\n  }\n\n  async focusDay(e: MouseEvent | KeyboardEvent, date: Date, step: number = 0) {\n    if (\n      dayIsDisabled(\n        date,\n        this.args.calendar,\n        this.args.minDate,\n        this.args.maxDate,\n        this.args.disabledDates,\n      )\n    ) {\n      return;\n    }\n\n    if (this.args.calendar.actions.moveCenter && step !== 0) {\n      await this.args.calendar.actions.moveCenter(\n        step,\n        'month',\n        this.args.calendar,\n        e,\n      );\n    }\n\n    this.focusedId = formatDate(date, 'YYYY-MM-DD');\n\n    if (step !== 0) {\n      scheduleOnce(\n        'afterRender',\n        this,\n        focusDate,\n        this.args.calendar.uniqueId,\n        this.focusedId ?? '',\n      );\n    } else {\n      focusDate(this.args.calendar.uniqueId, this.focusedId ?? '');\n    }\n  }\n\n  // Methods\n  buildDay(date: Date, today: Date, calendar: PowerCalendarRangeAPI) {\n    const day = buildDay(\n      date,\n      today,\n      calendar,\n      this.focusedId,\n      this.currentCenter,\n      this.dayIsSelected.bind(this),\n      this.args.minDate,\n      this.args.maxDate,\n      this.args.disabledDates,\n    );\n\n    const { start, end } = calendar.selected || { start: null, end: null };\n    if (start && end) {\n      day.isSelected = isBetween(date, start, end, 'day', '[]');\n      day.isRangeStart = day.isSelected && isSame(date, start, 'day');\n      day.isRangeEnd = day.isSelected && isSame(date, end, 'day');\n    } else {\n      day.isRangeEnd = false;\n      if (!start) {\n        day.isRangeStart = false;\n      } else {\n        day.isRangeStart = day.isSelected = isSame(date, start, 'day');\n        if (!day.isDisabled) {\n          const diffInMs = Math.abs(diff(day.date, start));\n          const minRange = calendar.minRange;\n          const maxRange = calendar.maxRange;\n          day.isDisabled =\n            (minRange && diffInMs < minRange) ||\n            (maxRange !== null &&\n              maxRange !== undefined &&\n              diffInMs > maxRange);\n        }\n      }\n    }\n    return day;\n  }\n\n  dayIsSelected() {\n    return false;\n  }\n\n  _updateFocused(id?: string | null) {\n    this.focusedId = id ?? null;\n  }\n\n  <template>\n    {{! template-lint-disable no-invalid-interactive }}\n    <div\n      class=\"ember-power-calendar-days\"\n      data-power-calendar-id={{or\n        @calendar.calendarUniqueId\n        @calendar.uniqueId\n      }}\n      role=\"grid\"\n      aria-labelledby=\"ember-power-calendar-nav-title-{{@calendar.uniqueId}}\"\n      {{on \"click\" this.handleClick}}\n      {{this.setup}}\n      ...attributes\n    >\n      <div\n        class=\"ember-power-calendar-row ember-power-calendar-weekdays\"\n        role=\"row\"\n      >\n        {{#each this.weekdaysNames as |wdn|}}\n          <div\n            class=\"ember-power-calendar-weekday\"\n            role=\"columnheader\"\n          >{{wdn}}</div>\n        {{/each}}\n      </div>\n      <div\n        class=\"ember-power-calendar-day-grid\"\n        role=\"rowgroup\"\n        {{on \"keydown\" this.handleKeyDown}}\n      >\n        {{#each this.weeks key=\"id\" as |week|}}\n          <div\n            class=\"ember-power-calendar-row ember-power-calendar-week\"\n            role=\"row\"\n            data-missing-days={{week.missingDays}}\n          >\n            {{#each week.days key=\"id\" as |day|}}\n              <button\n                type=\"button\"\n                role=\"gridcell\"\n                data-date=\"{{day.id}}\"\n                class={{emberPowerCalendarDayClasses\n                  day\n                  @calendar\n                  this.weeks\n                  @dayClass\n                }}\n                {{on \"focus\" this.handleDayFocus}}\n                {{on \"blur\" this.handleDayBlur}}\n                disabled={{day.isDisabled}}\n                tabindex={{if day.isFocused \"0\" \"-1\"}}\n                aria-selected={{if day.isSelected \"true\"}}\n              >\n                {{#if (has-block)}}\n                  {{yield day @calendar this.weeks}}\n                {{else}}\n                  {{day.number}}\n                {{/if}}\n              </button>\n            {{/each}}\n          </div>\n        {{/each}}\n      </div>\n    </div>\n  </template>\n}\n"],"names":["PowerCalendarRangeDays","Component","g","prototype","service","i","tracked","didSetup","lastKeyDownWasSpace","weekdayFormat","args","showDaysAround","undefined","weekdaysMin","withLocale","calendar","locale","getWeekdaysMin","weekdaysShort","getWeekdaysShort","weekdays","getWeekdays","localeStartOfWeek","localeStartOfWeekOrFallback","startOfWeek","weekdaysNames","days","today","powerCalendar","getDate","theLastDay","lastDay","currentCenter","day","firstDay","isBefore","push","buildDay","add","weeks","center","selected","start","normalizeDate","handleDayFocus","e","scheduleOnce","_updateFocused","bind","target","dataset","n","action","handleDayBlur","handleKeyDown","code","handleDayKeyDown","focusedId","isCurrentMonth","actions","moveCenter","key","currentDay","find","x","id","date","step","focusDay","focusDate","uniqueId","handleClick","selectedDay","minRange","end","DAY_IN_MS","dayInCurrentCalendar","some","formatDate","setup","modifier","autofocus","initialFocus","eager","activeDay","isSelected","isDisabled","todayDay","isToday","firstSelectableDay","dayIsDisabled","minDate","maxDate","disabledDates","dayIsSelected","isBetween","isRangeStart","isSame","isRangeEnd","diffInMs","Math","abs","diff","maxRange","setComponentTemplate","precompileTemplate","strictMode","scope","or","on","emberPowerCalendarDayClasses"],"mappings":"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"}