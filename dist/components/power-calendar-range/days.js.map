{"version":3,"file":"days.js","sources":["../../../src/components/power-calendar-range/days.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { scheduleOnce } from '@ember/runloop';\nimport service from '../../-private/service.ts';\nimport type {\n  PowerCalendarDaysArgs,\n  PowerCalendarDaysSignature,\n} from '../power-calendar/days.ts';\nimport {\n  isBetween,\n  isSame,\n  diff,\n  isBefore,\n  add,\n  withLocale,\n  getWeekdaysMin,\n  getWeekdaysShort,\n  getWeekdays,\n  normalizeDate,\n  type PowerCalendarDay,\n  formatDate,\n} from '../../utils.ts';\nimport type { PowerCalendarRangeAPI } from '../power-calendar-range.ts';\nimport {\n  buildDay,\n  firstDay,\n  lastDay,\n  localeStartOfWeekOrFallback,\n  weekdaysNames,\n  weeks,\n  handleDayKeyDown,\n  focusDate,\n  handleClick,\n  type TWeekdayFormat,\n  type Week,\n  dayIsDisabled,\n  DAY_IN_MS,\n} from '../../-private/days-utils.ts';\nimport { modifier } from 'ember-modifier';\nimport type PowerCalendarService from '../../services/power-calendar.ts';\n\ninterface PowerCalendarMultipleDaysArgs\n  extends Omit<PowerCalendarDaysArgs, 'calendar' | 'selected'> {\n  calendar: PowerCalendarRangeAPI;\n  selected?: {\n    start: Date | null;\n    end: Date | null;\n  };\n}\n\nexport interface PowerCalendarRangeDaysSignature\n  extends Omit<PowerCalendarDaysSignature, 'Args'> {\n  Args: PowerCalendarMultipleDaysArgs;\n}\n\nexport default class PowerCalendarRangeDaysComponent extends Component<PowerCalendarRangeDaysSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked focusedId: string | null = null;\n\n  didSetup = false;\n  lastKeyDownWasSpace = false;\n\n  get weekdayFormat(): TWeekdayFormat {\n    return this.args.weekdayFormat || 'short'; // \"min\" | \"short\" | \"long\"\n  }\n\n  get showDaysAround(): boolean {\n    return this.args.showDaysAround !== undefined\n      ? this.args.showDaysAround\n      : true;\n  }\n\n  get weekdaysMin(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysMin) as string[];\n  }\n\n  get weekdaysShort(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdaysShort) as string[];\n  }\n\n  get weekdays(): string[] {\n    return withLocale(this.args.calendar.locale, getWeekdays) as string[];\n  }\n\n  get localeStartOfWeek(): number {\n    return localeStartOfWeekOrFallback(\n      this.args.startOfWeek,\n      this.args.calendar.locale,\n    );\n  }\n\n  get weekdaysNames(): string[] {\n    return weekdaysNames(\n      this.localeStartOfWeek,\n      this.weekdayFormat,\n      this.weekdays,\n      this.weekdaysMin,\n      this.weekdaysShort,\n    );\n  }\n\n  get days(): PowerCalendarDay[] {\n    const today = this.powerCalendar.getDate();\n    const theLastDay = lastDay(this.localeStartOfWeek, this.currentCenter);\n    let day = firstDay(this.currentCenter, this.localeStartOfWeek);\n    const days: PowerCalendarDay[] = [];\n    while (isBefore(day, theLastDay)) {\n      days.push(this.buildDay(day, today, this.args.calendar));\n      day = add(day, 1, 'day');\n    }\n    return days;\n  }\n\n  get weeks(): Week[] {\n    return weeks(this.days, this.showDaysAround);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n\n    if (!center) {\n      center = this.args.selected?.start || this.args.calendar.center;\n    }\n    return normalizeDate(center) || this.args.calendar.center;\n  }\n\n  // Actions\n  @action\n  handleDayFocus(e: FocusEvent): void {\n    scheduleOnce(\n      'actions',\n      this,\n      this._updateFocused.bind(this),\n      (e.target as HTMLElement).dataset['date'],\n    );\n  }\n\n  @action\n  handleDayBlur(): void {\n    scheduleOnce('actions', this, this._updateFocused.bind(this), null);\n  }\n\n  @action\n  async handleKeyDown(e: KeyboardEvent): Promise<void> {\n    this.lastKeyDownWasSpace = e.code === 'Space';\n\n    const day = handleDayKeyDown(e, this.focusedId, this.days);\n\n    if (!day || !day?.isCurrentMonth) {\n      if (this.args.calendar.actions.moveCenter) {\n        if (\n          e.key === 'ArrowUp' ||\n          e.key === 'ArrowRight' ||\n          e.key === 'ArrowDown' ||\n          e.key === 'ArrowLeft'\n        ) {\n          const currentDay = this.days.find(\n            (x) => x.id === this.focusedId,\n          )?.date;\n\n          if (currentDay) {\n            let date = currentDay;\n            let step = 1;\n            if (e.key === 'ArrowUp') {\n              date = add(currentDay, -7, 'day');\n              step = -1;\n            } else if (e.key === 'ArrowLeft') {\n              date = add(currentDay, -1, 'day');\n              step = -1;\n            } else if (e.key === 'ArrowRight') {\n              date = add(currentDay, 1, 'day');\n            } else if (e.key === 'ArrowDown') {\n              date = add(currentDay, 7, 'day');\n            }\n\n            await this.focusDay(e, date, step);\n\n            return;\n          }\n        }\n      }\n    }\n\n    if (!day) {\n      return;\n    }\n\n    this.focusedId = day.id;\n    scheduleOnce(\n      'afterRender',\n      this,\n      focusDate,\n      this.args.calendar.uniqueId,\n      this.focusedId ?? '',\n    );\n  }\n\n  @action\n  async handleClick(e: MouseEvent) {\n    const selectedDay = handleClick(e, this.days, this.args.calendar);\n\n    if (\n      this.lastKeyDownWasSpace &&\n      selectedDay &&\n      (this.args.calendar.minRange ?? 0) > 0 &&\n      !this.args.calendar.selected?.end\n    ) {\n      const focusDay = add(\n        selectedDay.date,\n        (this.args.calendar.minRange ?? 0) / DAY_IN_MS,\n        'day',\n      );\n      const dayInCurrentCalendar = this.days.some(\n        (x) => x.id === formatDate(focusDay, 'YYYY-MM-DD') && x.isCurrentMonth,\n      );\n\n      await this.focusDay(e, focusDay, dayInCurrentCalendar ? 0 : 1);\n    }\n\n    this.lastKeyDownWasSpace = false;\n  }\n\n  setup = modifier(\n    () => {\n      if (this.didSetup) {\n        return;\n      }\n\n      this.didSetup = true;\n\n      if (this.args.autofocus) {\n        scheduleOnce('afterRender', this, this.initialFocus.bind(this));\n      }\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  initialFocus() {\n    const activeDay = this.days.find((x) => x.isSelected && !x.isDisabled);\n\n    if (activeDay) {\n      this.focusedId = activeDay.id;\n    } else {\n      const todayDay = this.days.find((x) => x.isToday && !x.isDisabled);\n      if (todayDay) {\n        this.focusedId = todayDay.id ?? '';\n      } else {\n        const firstSelectableDay = this.days.find((x) => !x.isDisabled);\n        if (firstSelectableDay) {\n          this.focusedId = firstSelectableDay.id ?? '';\n        } else {\n          this.focusedId = this.days.find((x) => !x.isCurrentMonth)?.id ?? '';\n        }\n      }\n    }\n\n    focusDate(this.args.calendar.uniqueId, this.focusedId ?? '');\n  }\n\n  async focusDay(e: MouseEvent | KeyboardEvent, date: Date, step: number = 0) {\n    if (\n      dayIsDisabled(\n        date,\n        this.args.calendar,\n        this.args.minDate,\n        this.args.maxDate,\n        this.args.disabledDates,\n      )\n    ) {\n      return;\n    }\n\n    if (this.args.calendar.actions.moveCenter && step !== 0) {\n      await this.args.calendar.actions.moveCenter(\n        step,\n        'month',\n        this.args.calendar,\n        e,\n      );\n    }\n\n    this.focusedId = formatDate(date, 'YYYY-MM-DD');\n\n    if (step !== 0) {\n      scheduleOnce(\n        'afterRender',\n        this,\n        focusDate,\n        this.args.calendar.uniqueId,\n        this.focusedId ?? '',\n      );\n    } else {\n      focusDate(this.args.calendar.uniqueId, this.focusedId ?? '');\n    }\n  }\n\n  // Methods\n  buildDay(date: Date, today: Date, calendar: PowerCalendarRangeAPI) {\n    const day = buildDay(\n      date,\n      today,\n      calendar,\n      this.focusedId,\n      this.currentCenter,\n      this.dayIsSelected.bind(this),\n      this.args.minDate,\n      this.args.maxDate,\n      this.args.disabledDates,\n    );\n\n    const { start, end } = calendar.selected || { start: null, end: null };\n    if (start && end) {\n      day.isSelected = isBetween(date, start, end, 'day', '[]');\n      day.isRangeStart = day.isSelected && isSame(date, start, 'day');\n      day.isRangeEnd = day.isSelected && isSame(date, end, 'day');\n    } else {\n      day.isRangeEnd = false;\n      if (!start) {\n        day.isRangeStart = false;\n      } else {\n        day.isRangeStart = day.isSelected = isSame(date, start, 'day');\n        if (!day.isDisabled) {\n          const diffInMs = Math.abs(diff(day.date, start));\n          const minRange = calendar.minRange;\n          const maxRange = calendar.maxRange;\n          day.isDisabled =\n            (minRange && diffInMs < minRange) ||\n            (maxRange !== null &&\n              maxRange !== undefined &&\n              diffInMs > maxRange);\n        }\n      }\n    }\n    return day;\n  }\n\n  dayIsSelected() {\n    return false;\n  }\n\n  _updateFocused(id?: string | null) {\n    this.focusedId = id ?? null;\n  }\n}\n"],"names":["PowerCalendarRangeDaysComponent","Component","g","prototype","service","i","void 0","tracked","didSetup","lastKeyDownWasSpace","weekdayFormat","args","showDaysAround","undefined","weekdaysMin","withLocale","calendar","locale","getWeekdaysMin","weekdaysShort","getWeekdaysShort","weekdays","getWeekdays","localeStartOfWeek","localeStartOfWeekOrFallback","startOfWeek","weekdaysNames","days","today","powerCalendar","getDate","theLastDay","lastDay","currentCenter","day","firstDay","isBefore","push","buildDay","add","weeks","center","selected","start","normalizeDate","handleDayFocus","e","scheduleOnce","_updateFocused","bind","target","dataset","n","action","handleDayBlur","handleKeyDown","code","handleDayKeyDown","focusedId","isCurrentMonth","actions","moveCenter","key","currentDay","find","x","id","date","step","focusDay","focusDate","uniqueId","handleClick","selectedDay","minRange","end","DAY_IN_MS","dayInCurrentCalendar","some","formatDate","setup","modifier","autofocus","initialFocus","eager","activeDay","isSelected","isDisabled","todayDay","isToday","firstSelectableDay","dayIsDisabled","minDate","maxDate","disabledDates","dayIsSelected","isBetween","isRangeStart","isSame","isRangeEnd","diffInMs","Math","abs","diff","maxRange","setComponentTemplate","TEMPLATE"],"mappings":"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"}