{"version":3,"file":"power-calendar.js","sources":["../../src/components/power-calendar.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport service from '../-private/service.ts';\nimport { task, type TaskInstance } from 'ember-concurrency';\nimport { assert } from '@ember/debug';\nimport { element } from 'ember-element-helper';\nimport { hash } from '@ember/helper';\nimport {\n  normalizeDate,\n  normalizeCalendarValue,\n  type NormalizeCalendarValue,\n  type PowerCalendarDay,\n  type SelectedPowerCalendarRange,\n  add,\n} from '../utils.ts';\nimport PowerCalendarNavComponent, {\n  type PowerCalendarNavSignature,\n} from './power-calendar/nav.gts';\nimport PowerCalendarDaysComponent, {\n  type PowerCalendarDaysSignature,\n} from './power-calendar/days.gts';\nimport type { ComponentLike } from '@glint/template';\nimport type Owner from '@ember/owner';\nimport type PowerCalendarService from '../services/power-calendar.ts';\n// import type {\n//   // PowerCalendarRangeAPI,\n//   PowerCalendarRangeDay,\n// } from './power-calendar-range.ts';\n// import type { PowerCalendarMultipleAPI } from './power-calendar-multiple.ts';\n\nexport type TCalendarType = 'multiple' | 'range' | 'single';\nexport type TPowerCalendarMoveCenterUnit = 'year' | 'month';\nexport type SelectedDays =\n  | SelectedPowerCalendarRange\n  | Date\n  | Date[]\n  | undefined;\n// export type CalendarAPI =\n//   | PowerCalendarAPI\n//   | PowerCalendarMultipleAPI\n//   | PowerCalendarRangeAPI;\n\nexport interface PowerCalendarAPI {\n  uniqueId: string;\n  calendarUniqueId?: string;\n  selected?: SelectedDays;\n  loading: boolean;\n  center: Date;\n  locale: string;\n  type: 'single';\n  actions: PowerCalendarActions;\n}\n\nexport interface PowerCalendarActions {\n  changeCenter?: (\n    newCenter: Date,\n    calendar: PowerCalendarAPI,\n    event: MouseEvent,\n  ) => TaskInstance<void>;\n  moveCenter?: (\n    step: number,\n    unit: TPowerCalendarMoveCenterUnit,\n    calendar: PowerCalendarAPI,\n    event: MouseEvent | KeyboardEvent,\n  ) => Promise<void>;\n  select?: (\n    day: PowerCalendarDay,\n    calendar: PowerCalendarAPI,\n    event: MouseEvent,\n  ) => void;\n}\n\nexport type TPowerCalendarOnSelect = (\n  day: PowerCalendarDay,\n  calendar: PowerCalendarAPI,\n  event?: Event,\n) => void;\n\nexport interface PowerCalendarArgs {\n  daysComponent?: ComponentLike<PowerCalendarDaysSignature>;\n  locale?: string;\n  navComponent?: ComponentLike<PowerCalendarNavSignature>;\n  onCenterChange?: (\n    newCenter: NormalizeCalendarValue,\n    calendar: PowerCalendarAPI,\n    event: Event,\n  ) => Promise<void> | void;\n  onInit?: (calendar: PowerCalendarAPI) => void;\n  onSelect?: TPowerCalendarOnSelect;\n  selected?: SelectedDays;\n  center?: Date;\n  tag?: keyof HTMLElementTagNameMap;\n  ariaLabel?: boolean;\n  ariaLabeledBy?: boolean;\n  isDatePicker?: boolean;\n  autofocus?: boolean;\n}\n\nexport interface PowerCalendarDefaultBlock extends PowerCalendarAPI {\n  Nav: ComponentLike<{\n    Args: Omit<PowerCalendarNavSignature['Args'], 'calendar'>;\n    Blocks: PowerCalendarNavSignature['Blocks'];\n  }>;\n  Days: ComponentLike<{\n    Element: PowerCalendarDaysSignature['Element'];\n    Args: Omit<PowerCalendarDaysSignature['Args'], 'calendar'>;\n    Blocks: PowerCalendarDaysSignature['Blocks'];\n  }>;\n}\n\n// ToDO: Refactor this!! no general type!\n// export type CalendarDay =\n//   | PowerCalendarDay\n//   | PowerCalendarRangeDay\n//   | PowerCalendarDay[];\n\nexport interface PowerCalendarSignature {\n  Element: HTMLElement;\n  Args: PowerCalendarArgs;\n  Blocks: {\n    default: [PowerCalendarDefaultBlock];\n  };\n}\n\nexport default class PowerCalendar extends Component<PowerCalendarSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked center = null;\n  @tracked _calendarType: TCalendarType = 'single';\n  @tracked _selected?: SelectedDays;\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: PowerCalendarArgs) {\n    super(owner, args);\n    this.registerCalendar();\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n  }\n\n  willDestroy(): void {\n    super.willDestroy();\n    this.unregisterCalendar();\n  }\n\n  get publicActions(): PowerCalendarActions {\n    const onSelect = this.args.onSelect;\n    const select = this.select.bind(this);\n    const onCenterChange = this.args.onCenterChange;\n    const changeCenterTask = this.changeCenterTask;\n    const currentCenter = this.currentCenter;\n\n    const actions: PowerCalendarActions = {};\n    if (onSelect) {\n      actions.select = (...args) => select(...args);\n    }\n    if (onCenterChange) {\n      const changeCenter = (\n        newCenter: Date,\n        calendar: PowerCalendarAPI,\n        e: Event,\n      ) => {\n        return changeCenterTask.perform(newCenter, calendar, e);\n      };\n      actions.changeCenter = changeCenter;\n      actions.moveCenter = async (step, unit, calendar, e) => {\n        const newCenter = add(currentCenter, step, unit);\n        return await changeCenter(newCenter, calendar, e);\n      };\n    }\n\n    return actions;\n  }\n\n  get selected(): SelectedDays {\n    if (this._selected) {\n      return this._selected;\n    }\n\n    return normalizeDate(this.args.selected as Date);\n  }\n\n  set selected(v: SelectedDays) {\n    this._selected = normalizeDate(v as Date | undefined);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n    if (!center) {\n      center = (this.selected as Date) || this.powerCalendar.getDate();\n    }\n    return normalizeDate(center) || this.powerCalendar.getDate();\n  }\n\n  get publicAPI(): PowerCalendarAPI {\n    return this._publicAPI;\n  }\n\n  get _publicAPI(): PowerCalendarAPI {\n    return {\n      uniqueId: guidFor(this),\n      type: 'single',\n      selected: this.selected,\n      loading: this.changeCenterTask.isRunning,\n      center: this.currentCenter,\n      locale: this.args.locale || this.powerCalendar.locale,\n      actions: this.publicActions,\n    };\n  }\n\n  get tagWithDefault(): keyof HTMLElementTagNameMap {\n    if (this.args.tag === undefined || this.args.tag === null) {\n      return 'div';\n    }\n    return this.args.tag;\n  }\n\n  get navComponent(): ComponentLike<PowerCalendarNavSignature> {\n    return (\n      this.args.navComponent ||\n      (PowerCalendarNavComponent as ComponentLike<PowerCalendarNavSignature>)\n    );\n  }\n\n  get daysComponent(): ComponentLike<PowerCalendarDaysSignature> {\n    return (\n      this.args.daysComponent ||\n      (PowerCalendarDaysComponent as ComponentLike<PowerCalendarDaysSignature>)\n    );\n  }\n\n  calendarAPI(\n    publicAPI: PowerCalendarAPI,\n    components: {\n      Nav: ComponentLike<PowerCalendarNavSignature>;\n      Days: ComponentLike<PowerCalendarDaysSignature>;\n    },\n  ): PowerCalendarDefaultBlock {\n    return Object.assign(\n      {},\n      publicAPI,\n      components,\n    ) as PowerCalendarDefaultBlock;\n  }\n\n  // Tasks\n  changeCenterTask = task(\n    async (newCenter: Date, calendar: PowerCalendarAPI, e: Event) => {\n      assert(\n        \"You attempted to move the center of a calendar that doesn't receive an `@onCenterChange` action.\",\n        typeof this.args.onCenterChange === 'function',\n      );\n      const value = normalizeCalendarValue({ date: newCenter });\n      await this.args.onCenterChange(value, calendar, e);\n    },\n  );\n\n  // Actions\n  @action\n  select(day: PowerCalendarDay, calendar: PowerCalendarAPI, e?: Event) {\n    if (this.args.onSelect) {\n      this.args.onSelect(day, calendar, e);\n    }\n  }\n\n  // Methods\n  registerCalendar() {\n    if (window) {\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      window.__powerCalendars = window.__powerCalendars || {}; // TODO: weakmap??\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      window.__powerCalendars[this.publicAPI.uniqueId] = this;\n    }\n  }\n\n  unregisterCalendar() {\n    // @ts-expect-error Property '__powerCalendars'\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (window && window.__powerCalendars?.[guidFor(this)]) {\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      delete window.__powerCalendars[guidFor(this)];\n\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      if (Object.keys(window.__powerCalendars).length === 0) {\n        // @ts-expect-error Property '__powerCalendars'\n        delete window.__powerCalendars;\n      }\n    }\n  }\n\n  <template>\n    {{#let\n      (this.calendarAPI\n        this.publicAPI\n        (hash\n          Nav=(component\n            this.navComponent calendar=this.publicAPI isDatePicker=@isDatePicker\n          )\n          Days=(component\n            this.daysComponent\n            calendar=this.publicAPI\n            isDatePicker=@isDatePicker\n            autofocus=@autofocus\n          )\n        )\n      )\n      as |calendar|\n    }}\n      {{#let (element this.tagWithDefault) as |Tag|}}\n        <Tag\n          class=\"ember-power-calendar\"\n          role={{if @isDatePicker \"dialog\" \"group\"}}\n          aria-modal={{if @isDatePicker \"true\"}}\n          aria-label={{if\n            @ariaLabel\n            @ariaLabel\n            (unless @ariaLabeledBy \"Choose Date\")\n          }}\n          aria-labelledby={{@ariaLabeledBy}}\n          ...attributes\n          id={{calendar.uniqueId}}\n        >\n          {{#if (has-block)}}\n            {{yield calendar}}\n          {{else}}\n            <calendar.Nav />\n            <calendar.Days />\n          {{/if}}\n        </Tag>\n      {{/let}}\n    {{/let}}\n  </template>\n}\n"],"names":["PowerCalendar","Component","g","prototype","service","i","tracked","constructor","owner","args","registerCalendar","onInit","publicAPI","willDestroy","unregisterCalendar","publicActions","onSelect","select","bind","onCenterChange","changeCenterTask","currentCenter","actions","changeCenter","newCenter","calendar","e","perform","moveCenter","step","unit","add","selected","_selected","normalizeDate","v","center","powerCalendar","getDate","_publicAPI","uniqueId","guidFor","type","loading","isRunning","locale","tagWithDefault","tag","undefined","navComponent","PowerCalendarNavComponent","daysComponent","PowerCalendarDaysComponent","calendarAPI","components","Object","assign","_buildTask","context","generator","assert","value","normalizeCalendarValue","date","day","n","action","window","__powerCalendars","keys","length","setComponentTemplate","precompileTemplate","strictMode","scope","hash","element"],"mappings":"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"}