{"version":3,"file":"power-calendar-multiple.js","sources":["../../src/components/power-calendar-multiple.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { guidFor } from '@ember/object/internals';\nimport service from '../-private/service.ts';\nimport { assert } from '@ember/debug';\nimport { isArray } from '@ember/array';\nimport { action } from '@ember/object';\nimport { task } from 'ember-concurrency';\nimport PowerCalendarMultipleDaysComponent, {\n  type PowerCalendarMultipleDaysSignature,\n} from './power-calendar-multiple/days.ts';\nimport PowerCalendarNavComponent, {\n  type PowerCalendarNavSignature,\n} from './power-calendar/nav.ts';\nimport { publicActionsObject } from '../-private/utils.ts';\nimport {\n  normalizeDate,\n  isSame,\n  normalizeMultipleActionValue,\n  normalizeCalendarValue,\n  type NormalizeMultipleActionValue,\n  type PowerCalendarDay,\n} from '../utils.ts';\nimport type {\n  CalendarAPI,\n  CalendarDay,\n  PowerCalendarAPI,\n  PowerCalendarActions,\n  PowerCalendarArgs,\n  SelectedDays,\n  TCalendarType,\n} from './power-calendar.ts';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type PowerCalendarService from '../services/power-calendar.ts';\n\nexport interface PowerCalendarMultipleAPI\n  extends Omit<PowerCalendarAPI, 'selected' | 'DaysComponent'> {\n  selected?: Date[];\n  DaysComponent: ComponentLike<PowerCalendarMultipleDaysSignature>;\n}\n\nexport type TPowerCalendarMultipleOnSelect = (\n  day: NormalizeMultipleActionValue,\n  calendar: PowerCalendarMultipleAPI,\n  event: MouseEvent,\n) => void;\n\ninterface PowerCalendarMultipleArgs\n  extends Omit<PowerCalendarArgs, 'selected' | 'daysComponent' | 'onSelect'> {\n  selected?: Date[];\n  daysComponent?: string | ComponentLike<PowerCalendarMultipleDaysSignature>;\n  onSelect?: TPowerCalendarMultipleOnSelect;\n}\n\ninterface PowerCalendarMultipleDefaultBlock extends PowerCalendarMultipleAPI {\n  Nav: ComponentLike<{\n    Args: Omit<PowerCalendarNavSignature['Args'], 'calendar'>;\n    Blocks: PowerCalendarNavSignature['Blocks'];\n  }>;\n  Days: ComponentLike<{\n    Element: PowerCalendarMultipleDaysSignature['Element'];\n    Args: Omit<PowerCalendarMultipleDaysSignature['Args'], 'calendar'>;\n    Blocks: PowerCalendarMultipleDaysSignature['Blocks'];\n  }>;\n}\n\ninterface PowerCalendarMultipleSignature {\n  Element: HTMLElement;\n  Args: PowerCalendarMultipleArgs;\n  Blocks: {\n    default: [PowerCalendarMultipleDefaultBlock];\n  };\n}\n\nexport default class PowerCalendarMultipleComponent extends Component<PowerCalendarMultipleSignature> {\n  @service declare powerCalendar: PowerCalendarService;\n\n  @tracked center = null;\n  @tracked _calendarType: TCalendarType = 'multiple';\n  @tracked _selected?: SelectedDays;\n\n  navComponent = PowerCalendarNavComponent;\n  daysComponent = PowerCalendarMultipleDaysComponent;\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: PowerCalendarMultipleArgs) {\n    super(owner, args);\n    this.registerCalendar();\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n  }\n\n  willDestroy(): void {\n    super.willDestroy();\n    this.unregisterCalendar();\n  }\n\n  get publicActions(): PowerCalendarActions {\n    return publicActionsObject(\n      this.args.onSelect,\n      this.select.bind(this),\n      this.args.onCenterChange,\n      this.changeCenterTask,\n      this.currentCenter,\n    );\n  }\n\n  get selected(): Date[] | undefined {\n    if (this._selected) {\n      return (this._selected as Date[]) || undefined;\n    }\n\n    const value = this.args.selected;\n\n    if (!isArray(value)) {\n      return value;\n    }\n\n    const selected: Date[] = [];\n\n    for (const date of value) {\n      const normalizedDate = normalizeDate(date);\n      if (!(normalizedDate instanceof Date)) {\n        continue;\n      }\n      selected.push(normalizedDate);\n    }\n\n    return selected;\n  }\n\n  set selected(v: SelectedDays) {\n    this._selected = normalizeDate(v as Date | undefined);\n  }\n\n  get currentCenter(): Date {\n    let center = this.args.center;\n    if (!center) {\n      center = (this.selected || [])[0] || this.powerCalendar.getDate();\n    }\n    return normalizeDate(center) || this.powerCalendar.getDate();\n  }\n\n  get publicAPI(): PowerCalendarAPI {\n    return {\n      uniqueId: guidFor(this),\n      type: this._calendarType,\n      selected: this.selected,\n      loading: this.changeCenterTask.isRunning,\n      center: this.currentCenter,\n      locale: this.args.locale || this.powerCalendar.locale,\n      actions: this.publicActions,\n    };\n  }\n\n  get tagWithDefault(): string {\n    if (this.args.tag === undefined || this.args.tag === null) {\n      return 'div';\n    }\n    return this.args.tag;\n  }\n\n  // Tasks\n  changeCenterTask = task(\n    async (newCenter: Date, calendar: PowerCalendarAPI, e: MouseEvent) => {\n      assert(\n        \"You attempted to move the center of a calendar that doesn't receive an `@onCenterChange` action.\",\n        typeof this.args.onCenterChange === 'function',\n      );\n      const value = normalizeCalendarValue({ date: newCenter });\n      await this.args.onCenterChange(value, calendar, e);\n    },\n  );\n\n  // Actions\n  @action\n  select(dayOrDays: CalendarDay, calendar: CalendarAPI, e: MouseEvent) {\n    assert(\n      `The select action expects an array of date objects, or a date object. ${typeof dayOrDays} was recieved instead.`,\n      isArray(dayOrDays) ||\n        (dayOrDays instanceof Object && dayOrDays.date instanceof Date),\n    );\n\n    let days;\n\n    if (isArray(dayOrDays)) {\n      days = dayOrDays;\n    } else if (dayOrDays instanceof Object && dayOrDays.date instanceof Date) {\n      days = [dayOrDays];\n    }\n\n    if (this.args.onSelect) {\n      this.args.onSelect(\n        this._buildCollection((days as PowerCalendarDay[]) ?? []),\n        calendar as PowerCalendarMultipleAPI,\n        e,\n      );\n    }\n  }\n\n  // Methods\n  _buildCollection(days: PowerCalendarDay[]): NormalizeMultipleActionValue {\n    let selected = this.selected || [];\n\n    for (const day of days) {\n      const index = selected.findIndex((selectedDate) =>\n        isSame(day.date, selectedDate, 'day'),\n      );\n      if (index === -1) {\n        selected = [...selected, day.date];\n      } else {\n        selected = selected.slice(0, index).concat(selected.slice(index + 1));\n      }\n    }\n\n    return normalizeMultipleActionValue({ date: selected });\n  }\n\n  // Methods\n  registerCalendar() {\n    if (window) {\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      window.__powerCalendars = window.__powerCalendars || {}; // TODO: weakmap??\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      window.__powerCalendars[this.publicAPI.uniqueId] = this;\n    }\n  }\n\n  unregisterCalendar() {\n    // @ts-expect-error Property '__powerCalendars'\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (window && window.__powerCalendars?.[guidFor(this)]) {\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      delete window.__powerCalendars[guidFor(this)];\n\n      // @ts-expect-error Property '__powerCalendars'\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      if (Object.keys(window.__powerCalendars).length === 0) {\n        // @ts-expect-error Property '__powerCalendars'\n        delete window.__powerCalendars;\n      }\n    }\n  }\n}\n"],"names":["PowerCalendarMultipleComponent","Component","g","prototype","service","i","void 0","tracked","navComponent","PowerCalendarNavComponent","daysComponent","PowerCalendarMultipleDaysComponent","constructor","owner","args","registerCalendar","onInit","publicAPI","willDestroy","unregisterCalendar","publicActions","publicActionsObject","onSelect","select","bind","onCenterChange","changeCenterTask","currentCenter","selected","_selected","undefined","value","isArray","date","normalizedDate","normalizeDate","Date","push","v","center","powerCalendar","getDate","uniqueId","guidFor","type","_calendarType","loading","isRunning","locale","actions","tagWithDefault","tag","_buildTask","context","generator","newCenter","calendar","e","assert","normalizeCalendarValue","dayOrDays","Object","days","_buildCollection","n","action","day","index","findIndex","selectedDate","isSame","slice","concat","normalizeMultipleActionValue","window","__powerCalendars","keys","length","setComponentTemplate","TEMPLATE"],"mappings":"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"}