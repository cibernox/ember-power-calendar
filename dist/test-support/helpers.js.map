{"version":3,"file":"helpers.js","sources":["../../src/test-support/helpers.ts"],"sourcesContent":["import { assert } from '@ember/debug';\nimport { click, settled, find } from '@ember/test-helpers';\nimport { formatDate } from '../utils.ts';\nimport type PowerCalendarMultiple from '../components/power-calendar-multiple.ts';\nimport type PowerCalendar from '../components/power-calendar.ts';\nimport type PowerCalendarRange from '../components/power-calendar-range.ts';\n\nexport default {};\n\nexport * from '../utils.ts';\n\nfunction findCalendarElement(selector: string): Element | null | undefined {\n  const target = find(selector);\n\n  if (target) {\n    if (target.classList.contains('ember-power-calendar')) {\n      return target;\n    } else {\n      return (\n        target.querySelector('.ember-power-calendar') ||\n        target.querySelector('[data-power-calendar-id]')\n      );\n    }\n  }\n}\n\nfunction findCalendarGuid(selector: string): string | undefined {\n  const maybeCalendar = findCalendarElement(selector);\n  if (!maybeCalendar) {\n    return;\n  }\n  if (maybeCalendar.classList.contains('ember-power-calendar')) {\n    return maybeCalendar.id;\n  } else {\n    return (maybeCalendar as HTMLElement).dataset['powerCalendarId'];\n  }\n}\n\nfunction findComponentInstance(\n  selector: string,\n): PowerCalendar | PowerCalendarMultiple | PowerCalendarRange {\n  const calendarGuid = findCalendarGuid(selector);\n  assert(\n    `Could not find a calendar using selector: \"${selector}\"`,\n    calendarGuid,\n  );\n  // @ts-expect-error Property '__powerCalendars'\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-member-access\n  return window.__powerCalendars?.[calendarGuid];\n}\n\nexport async function calendarCenter(\n  selector: string,\n  newCenter: Date,\n): Promise<void> {\n  assert(\n    '`calendarCenter` expect a Date object as second argument',\n    newCenter instanceof Date,\n  );\n  const calendarComponent = findComponentInstance(selector) as PowerCalendar;\n  const onCenterChange = calendarComponent.args.onCenterChange;\n  assert(\n    \"You cannot call `calendarCenter` on a component that doesn't has an `@onCenterChange` action\",\n    !!onCenterChange,\n  );\n  const publicAPI = calendarComponent.publicAPI;\n  await publicAPI.actions.changeCenter!(newCenter, publicAPI, {} as MouseEvent);\n  return settled();\n}\n\nexport async function calendarSelect(\n  selector: string,\n  selected: Date,\n): Promise<void> {\n  assert('`calendarSelect` expect a Date object as second argument', selected);\n  const calendarElement = findCalendarElement(selector);\n  const daySelector = `${selector} [data-date=\"${formatDate(\n    selected,\n    'YYYY-MM-DD',\n  )}\"]`;\n  const dayElement = calendarElement?.querySelector(daySelector);\n  if (!dayElement) {\n    await calendarCenter(selector, selected);\n  }\n  return click(daySelector);\n}\n"],"names":["findCalendarElement","selector","target","find","classList","contains","querySelector","findCalendarGuid","maybeCalendar","id","dataset","findComponentInstance","calendarGuid","assert","window","__powerCalendars","calendarCenter","newCenter","Date","calendarComponent","onCenterChange","args","publicAPI","actions","changeCenter","settled","calendarSelect","selected","calendarElement","daySelector","formatDate","dayElement","click"],"mappings":";;;;;AAOA,cAAe,EAAE;AAIjB,SAASA,mBAAmBA,CAACC,QAAgB,EAA8B;AACzE,EAAA,MAAMC,MAAM,GAAGC,IAAI,CAACF,QAAQ,CAAC;AAE7B,EAAA,IAAIC,MAAM,EAAE;IACV,IAAIA,MAAM,CAACE,SAAS,CAACC,QAAQ,CAAC,sBAAsB,CAAC,EAAE;AACrD,MAAA,OAAOH,MAAM;AACf,IAAA,CAAC,MAAM;AACL,MAAA,OACEA,MAAM,CAACI,aAAa,CAAC,uBAAuB,CAAC,IAC7CJ,MAAM,CAACI,aAAa,CAAC,0BAA0B,CAAC;AAEpD,IAAA;AACF,EAAA;AACF;AAEA,SAASC,gBAAgBA,CAACN,QAAgB,EAAsB;AAC9D,EAAA,MAAMO,aAAa,GAAGR,mBAAmB,CAACC,QAAQ,CAAC;EACnD,IAAI,CAACO,aAAa,EAAE;AAClB,IAAA;AACF,EAAA;EACA,IAAIA,aAAa,CAACJ,SAAS,CAACC,QAAQ,CAAC,sBAAsB,CAAC,EAAE;IAC5D,OAAOG,aAAa,CAACC,EAAE;AACzB,EAAA,CAAC,MAAM;AACL,IAAA,OAAQD,aAAa,CAAiBE,OAAO,CAAC,iBAAiB,CAAC;AAClE,EAAA;AACF;AAEA,SAASC,qBAAqBA,CAC5BV,QAAgB,EAC4C;AAC5D,EAAA,MAAMW,YAAY,GAAGL,gBAAgB,CAACN,QAAQ,CAAC;AAC/CY,EAAAA,MAAM,CACJ,CAAA,2CAAA,EAA8CZ,QAAQ,CAAA,CAAA,CAAG,EACzDW,YACF,CAAC;AACD;AACA;AACA,EAAA,OAAOE,MAAM,CAACC,gBAAgB,GAAGH,YAAY,CAAC;AAChD;AAEO,eAAeI,cAAcA,CAClCf,QAAgB,EAChBgB,SAAe,EACA;AACfJ,EAAAA,MAAM,CACJ,0DAA0D,EAC1DI,SAAS,YAAYC,IACvB,CAAC;AACD,EAAA,MAAMC,iBAAiB,GAAGR,qBAAqB,CAACV,QAAQ,CAAkB;AAC1E,EAAA,MAAMmB,cAAc,GAAGD,iBAAiB,CAACE,IAAI,CAACD,cAAc;AAC5DP,EAAAA,MAAM,CACJ,8FAA8F,EAC9F,CAAC,CAACO,cACJ,CAAC;AACD,EAAA,MAAME,SAAS,GAAGH,iBAAiB,CAACG,SAAS;AAC7C,EAAA,MAAMA,SAAS,CAACC,OAAO,CAACC,YAAY,CAAEP,SAAS,EAAEK,SAAS,EAAE,EAAgB,CAAC;EAC7E,OAAOG,OAAO,EAAE;AAClB;AAEO,eAAeC,cAAcA,CAClCzB,QAAgB,EAChB0B,QAAc,EACC;AACfd,EAAAA,MAAM,CAAC,0DAA0D,EAAEc,QAAQ,CAAC;AAC5E,EAAA,MAAMC,eAAe,GAAG5B,mBAAmB,CAACC,QAAQ,CAAC;EACrD,MAAM4B,WAAW,GAAG,CAAA,EAAG5B,QAAQ,CAAA,aAAA,EAAgB6B,UAAU,CACvDH,QAAQ,EACR,YACF,CAAC,CAAA,EAAA,CAAI;AACL,EAAA,MAAMI,UAAU,GAAGH,eAAe,EAAEtB,aAAa,CAACuB,WAAW,CAAC;EAC9D,IAAI,CAACE,UAAU,EAAE;AACf,IAAA,MAAMf,cAAc,CAACf,QAAQ,EAAE0B,QAAQ,CAAC;AAC1C,EAAA;EACA,OAAOK,KAAK,CAACH,WAAW,CAAC;AAC3B;;;;"}